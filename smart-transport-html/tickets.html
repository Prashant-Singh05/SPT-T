<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Tickets - Smart Transport</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
    <!-- QR Code Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-container">
                <a href="index.html" class="logo">
                    üöå Smart Transport
                </a>
                <ul class="nav-links">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="routes.html">Routes</a></li>
                    <li><a href="schedules.html">Schedules</a></li>
                    <li><a href="tickets.html" class="active">Tickets</a></li>
                    <li><a href="admin.html">Admin</a></li>
                    <li><a href="login.html">Login</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Page Header -->
    <section class="section">
        <div class="container">
            <div class="text-center mb-5">
                <h1>Book Your Ticket</h1>
                <p>Purchase tickets for your journey with our smart transport system</p>
            </div>

            <div class="grid grid-2">
                <!-- Booking Form -->
                <div>
                    <div class="card">
                        <div class="card-header">
                            <h3>üé´ Ticket Booking Form</h3>
                            <p>Fill in your details to book a ticket</p>
                        </div>
                        <div class="card-body">
                            <form id="ticket-form">
                                <!-- Route Selection -->
                                <div class="form-group">
                                    <label class="form-label">Select Route</label>
                                    <select class="form-select" id="route-select" name="route" required>
                                        <option value="">Choose a route</option>
                                        <!-- Routes will be populated dynamically -->
                                    </select>
                                </div>

                                <!-- Travel Date -->
                                <div class="form-group">
                                    <label class="form-label">Travel Date</label>
                                    <input type="date" class="form-input" id="travel-date" name="travel-date" required>
                                </div>

                                <!-- Passenger Type and Quantity -->
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Passenger Type</label>
                                        <select class="form-select" id="passenger-type" name="passenger-type" required>
                                            <option value="adult">Adult (Full Price)</option>
                                            <option value="student">Student (30% Discount)</option>
                                            <option value="senior">Senior 65+ (50% Discount)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Quantity</label>
                                        <input type="number" class="form-input" id="quantity" name="quantity" min="1" max="10" value="1" required>
                                    </div>
                                </div>

                                <!-- Passenger Details -->
                                <div class="mt-4">
                                    <h4>Passenger Details</h4>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="form-label">Full Name</label>
                                            <input type="text" class="form-input" name="passenger-name" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Email</label>
                                            <input type="email" class="form-input" name="passenger-email" required>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Phone Number</label>
                                        <input type="tel" class="form-input" name="passenger-phone" required>
                                    </div>
                                </div>

                                <button type="submit" class="btn btn-primary w-full">Book Ticket</button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Booking Summary -->
                <div>
                    <div class="card">
                        <div class="card-header">
                            <h3>Booking Summary</h3>
                        </div>
                        <div class="card-body">
                            <div id="booking-summary">
                                <p class="text-center text-gray-600">Select a route to see pricing</p>
                            </div>
                        </div>
                    </div>

                    <!-- Student Pass Information -->
                    <div class="card mt-4">
                        <div class="card-header">
                            <h3>Student Pass Information</h3>
                        </div>
                        <div class="card-body">
                            <div style="background: #dbeafe; padding: 1rem; border-radius: 0.5rem;">
                                <h4 style="color: #1e40af; margin-bottom: 0.5rem;">Student Discount Available</h4>
                                <p style="color: #1e40af; margin-bottom: 1rem;">Students with valid ID can enjoy 30% discount on all routes.</p>
                                <ul style="color: #1e40af; font-size: 0.875rem;">
                                    <li>‚Ä¢ Valid student ID required</li>
                                    <li>‚Ä¢ Discount applies to all routes</li>
                                    <li>‚Ä¢ Available for full-time students</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ticket Result (Hidden initially) -->
            <div id="ticket-result" class="hidden mt-5">
                <!-- Ticket will be displayed here after booking -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div>
                    <h3>Smart Transport</h3>
                    <p>Your reliable partner for smart public transportation.</p>
                </div>
                <div>
                    <h3>Quick Links</h3>
                    <ul style="list-style: none;">
                        <li><a href="routes.html">Routes</a></li>
                        <li><a href="schedules.html">Schedule</a></li>
                        <li><a href="tickets.html">Tickets</a></li>
                        <li><a href="admin.html">Admin</a></li>
                    </ul>
                </div>
                <div>
                    <h3>Contact Info</h3>
                    <p>üìç 123 Transport St, City, State 12345</p>
                    <p>üìû +1 (555) 123-4567</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Smart Transport. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="js/app.js"></script>
    <script>
        // Set minimum date to today
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('travel-date').min = today;
        });

        // Populate route options
        function populateRouteOptions() {
            const routeSelect = document.getElementById('route-select');
            if (routeSelect && routesData.length > 0) {
                routeSelect.innerHTML = '<option value="">Choose a route</option>' +
                    routesData.map(route => 
                        `<option value="${route.id}" data-price="${route.price}">${route.name} (#${route.number}) - $${route.price}</option>`
                    ).join('');
            }
        }

        // Update booking summary
        function updateBookingSummary() {
            const routeSelect = document.getElementById('route-select');
            const passengerTypeSelect = document.getElementById('passenger-type');
            const quantityInput = document.getElementById('quantity');
            const summaryDiv = document.getElementById('booking-summary');
            
            if (!routeSelect || !passengerTypeSelect || !quantityInput || !summaryDiv) return;
            
            const selectedRoute = routeSelect.options[routeSelect.selectedIndex];
            const basePrice = parseFloat(selectedRoute.dataset.price) || 0;
            const passengerType = passengerTypeSelect.value;
            const quantity = parseInt(quantityInput.value) || 1;
            
            if (basePrice === 0) {
                summaryDiv.innerHTML = '<p class="text-center text-gray-600">Select a route to see pricing</p>';
                return;
            }
            
            let discount = 1;
            let discountText = '';
            switch (passengerType) {
                case 'student':
                    discount = 0.7;
                    discountText = '30% student discount';
                    break;
                case 'senior':
                    discount = 0.5;
                    discountText = '50% senior discount';
                    break;
                default:
                    discount = 1;
                    discountText = 'Full price';
            }
            
            const finalPrice = basePrice * discount * quantity;
            const savings = (basePrice * quantity) - finalPrice;
            
            summaryDiv.innerHTML = `
                <div>
                    <h4>${selectedRoute.text}</h4>
                    <div class="mt-3">
                        <div class="flex justify-between text-sm mb-2">
                            <span>Base Price:</span>
                            <span>$${basePrice.toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between text-sm mb-2">
                            <span>Passenger Type:</span>
                            <span class="capitalize">${passengerType}</span>
                        </div>
                        <div class="flex justify-between text-sm mb-2">
                            <span>Quantity:</span>
                            <span>${quantity}</span>
                        </div>
                        ${discount < 1 ? `
                            <div class="flex justify-between text-sm text-green-600 mb-2">
                                <span>Discount:</span>
                                <span>${discountText}</span>
                            </div>
                            <div class="flex justify-between text-sm text-green-600 mb-2">
                                <span>Savings:</span>
                                <span>$${savings.toFixed(2)}</span>
                            </div>
                        ` : ''}
                        <div class="border-t pt-2">
                            <div class="flex justify-between font-bold text-lg">
                                <span>Total Price:</span>
                                <span style="color: #10b981;">$${finalPrice.toFixed(2)}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Set up event listeners for form changes
        document.addEventListener('DOMContentLoaded', function() {
            // Wait for data to load
            setTimeout(() => {
                populateRouteOptions();
                
                // Set up event listeners
                const routeSelect = document.getElementById('route-select');
                const passengerTypeSelect = document.getElementById('passenger-type');
                const quantityInput = document.getElementById('quantity');
                
                if (routeSelect) {
                    routeSelect.addEventListener('change', updateBookingSummary);
                }
                if (passengerTypeSelect) {
                    passengerTypeSelect.addEventListener('change', updateBookingSummary);
                }
                if (quantityInput) {
                    quantityInput.addEventListener('change', updateBookingSummary);
                }
            }, 1000);
        });

        // Handle URL route parameter
        window.addEventListener('load', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const routeId = urlParams.get('route');
            if (routeId) {
                setTimeout(() => {
                    const routeSelect = document.getElementById('route-select');
                    if (routeSelect) {
                        routeSelect.value = routeId;
                        updateBookingSummary();
                    }
                }, 1000);
            }
        });
    </script>
</body>
</html>
